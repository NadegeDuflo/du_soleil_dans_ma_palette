{% extends 'base.html' %}
{% load static %}


{% block title %} <title>{{ post.title }}</title> {% endblock %}

{% block content %}
 <main id="blog-detail">
    <article>
        {% if request.user.is_authenticated %}
        {% include "website/tools.html" %}
        {% endif %}

        
        <h1>{{ post.title }}</h1>

        <img class="img-chapo" src="{{ post.thumbnail.url }}" alt="{{ post.alt}}">
        <p class="legend">{{ post.chapo|safe }}</p>

        <svg class="separateur" width="3164" height="136" version="1.1" viewBox="0 0 3164 136">
        <path d="m240 128v2.6667c15.08 6.8413 38.773 3.392 51.985-6.266 5.3467-3.9083 8.4213-9.9643 13.647-13.89 9.024-6.7817 22.567-12.997 33.035-17.177l5.3333 6.6667-5.3333-9.3333c3.4773-1.758 6.24-3.6173 8.7267-6.7225 21.66-27.06-31.956-34.761-18.132-3.9496 1.6627 3.7056 3.8613 6.5455 6.7387 9.3388v1.3333l-29.333 14.667c10.011-55.139-53.709-63.282-90.667-78.667 22.651-9.706 43.605-22.465 69.333-21.254 63.183 2.9746 103.02 67.881 164 79.556 45.647 8.7387 96.317 3.0313 142.67 3.0313h2018.7c34.307 0 71.693 4.1443 105.33-3.5448 59.547-13.612 100.33-76.108 162.67-79.042 26.08-1.2278 46.133 12.43 69.333 21.254v1.3333c-39.707 5.4143-99.547 28.399-90.667 77.333-6.5466-2.2765-25.013-7.96-26.773-15.614-2.16-9.3891 15.027-20.989 1.2267-29.405-8.4134-5.1373-20.707-0.04787-20.64 10.356 0.053 9.1771 7.1066 16.532 14.187 21.329v1.3333l-6.6666 8 6.6666-8c10.227 4.8901 22.36 10.051 31.707 16.36 6.28 4.2381 9.9867 11.408 16.293 15.835 12.787 8.9827 36.36 11.628 50.667 5.1387v-2.6667c-12.68-4.9015-25.64-8.7257-38.667-12.577-5.96-1.7636-13.507-3.304-17.027-8.9611-7.9467-12.745-0.2134-29.091 9.0666-38.425 16.627-16.721 54.04-35.778 78.627-32.825 15.4 1.8496 32.213 24.435 41.44 35.455 30.733 36.669 66.707 58.586 114.56 64.752 24.28 3.128 59.787-2.9151 50.053-35.419-1.4133-4.7124-3.52-9.24-6.2533-13.333-30.053-44.999-103.93-61.132-154.47-62.631-14.32-0.4248-28.453 2.0485-42.667 1.8069-10.36-0.17613-21.333-9.8761-30.667-14.009-17.987-7.9651-38.853-13.418-58.667-11.572-54.213 5.0525-97.093 45.306-148 61.024-48.853 15.085-107.99 6.7141-158.67 6.7141h-1997.3c-34.133 0-70.209 3.2967-104-1.9452-60.567-9.3953-106.35-60.048-168-65.793-18.969-1.7676-40.201 3.4964-57.333 11.463-8.756 4.0716-18.544 12.173-28 13.914-14.436 2.6565-31.756-2.2741-46.667-1.5593-50.101 2.4016-125.79 17.492-154.26 63.921-2.5339 4.1312-4.5664 8.6389-5.7966 13.333-8.4003 32.056 27.194 37.127 50.727 33.896 49.187-6.7521 83.193-28.731 115.26-65.896 9.1453-10.601 25.784-32.461 40.743-34.131 24.447-2.7287 62.012 16.204 78.583 32.878 9.4667 9.5251 16.752 25.582 8.7773 38.382-8.344 13.392-41.384 15.15-55.36 21.538m-44-94.667c-15.571 19.187-47.101 27.571-69.333 36.276-27.563 10.792-51.706 25.608-76 42.344-10.864 7.4837-31.444 19.973-41.382 3.9489-9.5127-15.339 23.158-38.619 33.382-45.978 45.318-32.62 99.789-36.701 153.33-36.591m2772 0c53.507-0.30813 108.23 4.0307 153.33 36.868 10.587 7.7067 43.56 31.082 32.373 46.928-10.707 15.173-31.067 1.0828-41.707-6.0181-29.24-19.509-58.027-34.59-90.667-47.644-16.427-6.5696-43.187-14.783-53.333-30.133m-2632 56c-1.9733-3.4312-4.0293-6.9001-5.3093-10.668-9.2507-27.222 32.227-18.883 14.035 3.9455-2.4773 3.1087-5.252 4.9663-8.7253 6.7225m2492 0c-3.44-1.2965-6.1067-2.6621-8.56-5.5421-19.373-22.829 23.227-33.32 13.693-5.1259-1.2666 3.7381-3.3066 7.1871-5.1333 10.668m-2482.7 13.333 10.667 10.667-10.667-10.667m2469.3 2.6667-12 13.333 12-13.333m-2525.3 10.667c-8.3 14.102-25.728 13.333-40 13.333 10.037-7.0557 27.911-11.386 40-13.333m2625.3 12v1.3333c-14.2 0-31.96 1.0121-40-13.333l40 12m-2549.3-5.3333 1.3333 1.3333z" ></path>
        </svg>
        <div class="content">{{ post.content|safe }}</div>

        <div class="edition"><p class="subtitle">Publié par <span class="author">{{ post.author_or_default }}</span> dans <span class="category">{{ post.category.all|join:", " }}</span> le {{ post.created_on|date:'j F Y' }}</p></div>

        <div class="comment-container">
            <h4>{% if post.get_comments %} {{ post.get_comments.count }} {% else %} Pas de {% endif %} commentaire(s) :</h4>
            <ul>
                {% for comment in post.get_comments %}
                    <li class="comment-item">
                        <h5>{{ comment.author_comment }} a commenté le {{ comment.created_on }}</h5>

                        {% if comment.status == "moderated" %}
                            <p>{{ comment.moderation_text }}</p>
                        {% else %}
                            <p>{{ comment.content_comment }}</p>
                        {% endif %}
                        <button>Répondre...</button>
                        <form method="POST" class="reply">
                            {% csrf_token %}
                            <label for="sp-mail"></label>
                            <input class="sp-mail" name="sp-mail"
                                pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$"
                                placeholder="nom@domaine.com">
                            <input type="hidden" name="comment" value= "{{ comment.id }}">
                            <h6>Répondre à {{ comment.author_comment }}</h6> 
                                            
                            {{ form2.as_p}}
                
                            <span>{{ spam_question }} </span> <input class = "sp-question" name= "sp-question" required="true"><br>
                
                            <input type="submit" value="Envoyer votre réponse" name="submit_reply">
                        </form>
                        {% if comment.get_answers %}
                            <ul>
                                {% for answer in comment.get_answers %}
                                <li class="answer-item">
                                    <h5> {{ answer.author_answer }} a répondu le {{ answer.created_on }}</h5>
                                    <p>{{ answer.content_answer }}</p>
                                </li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </li>
                    {% empty %}
                    <li class="comment-item">Votre commentaire...</li>
            </ul>
             {% endfor%}
            <h4>
                <svg width="800px" height="800px" viewBox="0 0 24 24" xmlns="" id="chat-alt-3" class="icon glyph"><path d="M19.91,16.51A8.45,8.45,0,0,0,22,11c0-5-4.49-9-10-9S2,6,2,11s4.49,9,10,9a10.9,10.9,0,0,0,3-.41l4.59,2.3A.91.91,0,0,0,20,22a1,1,0,0,0,.62-.22,1,1,0,0,0,.35-1ZM8,12a1,1,0,1,1,1-1A1,1,0,0,1,8,12Zm4,0a1,1,0,1,1,1-1A1,1,0,0,1,12,12Zm4,0a1,1,0,1,1,1-1A1,1,0,0,1,16,12Z" ></path></svg>
            </h4>
            <form method="POST">
                {% csrf_token %}
                <label for="sp-mail"></label>
                <input class="sp-mail" name="sp-mail"
                    pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$"
                    placeholder="nom@domaine.com">

                {{ form.as_p }}

                <span>{{ spam_question }} </span> <input class = "sp-question" name= "sp-question" required="true"><br>

                <input type="submit" value="Commenter" name="submit_comment">
            </form>
            

            

        </div>

    </article>

    <ul class="item-nav">

        {% if previous_post %}
            <li><a href="{% url 'blog:post' slug=previous_post.slug %}">« Vers {{ previous_post.title }}</a>
        {% else %}
            <li disabled>« Article précédent</button>
        {% endif %}
        </li>

        <li><a href="{% url 'blog:home' %}">Retour au journal</a></li>

        {% if next_post %}
            <li><a href="{% url 'blog:post' slug=next_post.slug %}">Vers {{ next_post.title }} »;</a>
        {% else %}
            <li disabled>Article suivant &raquo;</button>
        {% endif %}
        </li>

    </ul>
 </main>
{% endblock %}

{% block script %}
<script src="{% static 'scripts/script_blog_detail.js' %}"></script>      
{% endblock script %}